// import CountUp from "react-countup";

// function SectionCandidateOverview() {
//     return (
//         <>
//             <div className="wt-admin-right-page-header">
//                 <h2>Randall Henderson</h2>
//                 <p>IT Contractor</p>
//             </div>

//             <div className="twm-dash-b-blocks mb-5">
//                 <div className="row">
//                     {/* Card 1 - Credits Available */}
//                     <div className="col-xl-6 col-lg-6 col-md-12 mb-3">
//                         <div className="panel panel-default">
//                             <div className="panel-body wt-panel-body dashboard-card-2" style={{ backgroundColor: '#f0f4ff' }}>
//                                 <div className="wt-card-wrap-2 d-flex align-items-center justify-content-between">
//                                     <div className="wt-card-icon-2"><i className="flaticon-job" /></div>
//                                     <div className="wt-card-right counter fw-bold fs-4 text-primary">
//                                         <CountUp end={25} duration={2} />
//                                     </div>
//                                 </div>
//                                 <div className="wt-card-bottom-2 mt-2">
//                                     <h4 className="m-b0">Credits Available</h4>
//                                 </div>
//                             </div>
//                         </div>
//                     </div>

//                     {/* Card 2 - Application Sent */}
//                     <div className="col-xl-6 col-lg-6 col-md-12 mb-3">
//                         <div className="panel panel-default">
//                             <div className="panel-body wt-panel-body dashboard-card-2" style={{ backgroundColor: '#e0f7fa' }}>
//                                 <div className="wt-card-wrap-2 d-flex align-items-center justify-content-between">
//                                     <div className="wt-card-icon-2"><i className="flaticon-resume" /></div>
//                                     <div className="wt-card-right counter fw-bold fs-4 text-info">
//                                         <CountUp end={435} duration={2} />
//                                     </div>
//                                 </div>
//                                 <div className="wt-card-bottom-2 mt-2">
//                                     <h4 className="m-b0">Application Sent</h4>
//                                 </div>
//                             </div>
//                         </div>
//                     </div>

//                     {/* Card 3 - In Progress */}
//                     <div className="col-xl-6 col-lg-6 col-md-12 mb-3">
//                         <div className="panel panel-default">
//                             <div className="panel-body wt-panel-body dashboard-card-2" style={{ backgroundColor: '#fff3e0' }}>
//                                 <div className="wt-card-wrap-2 d-flex align-items-center justify-content-between">
//                                     <div className="wt-card-icon-2"><i className="flaticon-envelope" /></div>
//                                     <div className="wt-card-right counter fw-bold fs-4 text-warning">
//                                         <CountUp end={28} duration={2} />
//                                     </div>
//                                 </div>
//                                 <div className="wt-card-bottom-2 mt-2">
//                                     <h4 className="m-b0">In Progress</h4>
//                                 </div>
//                             </div>
//                         </div>
//                     </div>

//                     {/* Card 4 - Assessments */}
//                     <div className="col-xl-6 col-lg-6 col-md-12 mb-3">
//                         <div className="panel panel-default">
//                             <div className="panel-body wt-panel-body dashboard-card-2" style={{ backgroundColor: '#e8f5e9' }}>
//                                 <div className="wt-card-wrap-2 d-flex align-items-center justify-content-between">
//                                     <div className="wt-card-icon-2"><i className="flaticon-bell" /></div>
//                                     <div className="wt-card-right counter fw-bold fs-4 text-success">
//                                         <CountUp end={18} duration={2} />
//                                     </div>
//                                 </div>
//                                 <div className="wt-card-bottom-2 mt-2">
//                                     <h4 className="m-b0">Assessments</h4>
//                                 </div>
//                             </div>
//                         </div>
//                     </div>
//                 </div>
//             </div>
//         </>
//     );
// }

// export default SectionCandidateOverview;

// import CountUp from "react-countup";

// function SectionCandidateOverview() {
// 	return (
// 		<>
// 			<div className="wt-admin-right-page-header">
// 				<h2>Randall Henderson</h2>
// 				<p>IT Contractor</p>
// 			</div>

// 			<div className="twm-dash-b-blocks mb-5">
// 				<div className="row">
// 					{/* Card 1 - Credits Available */}
// 					<div className="col-xl-6 col-lg-6 col-md-12 mb-3">
// 						<div className="panel panel-default">
// 							<div
// 								className="panel-body wt-panel-body dashboard-card-2"
// 								style={{ backgroundColor: "#f0f4ff" }}
// 							>
// 								<div className="wt-card-wrap-2 d-flex align-items-center justify-content-between">
// 									<div className="wt-card-icon-2">
// 										<i className="flaticon-job" />
// 									</div>
// 									<div className="wt-card-right counter fw-bold fs-4 text-primary">
// 										<CountUp end={25} duration={2} />
// 									</div>
// 								</div>
// 								<div className="wt-card-bottom-2 mt-2">
// 									<h4 className="m-b0">Credits Available</h4>
// 								</div>
// 							</div>
// 						</div>
// 					</div>

// 					{/* Card 2 - Application Sent */}
// 					<div className="col-xl-6 col-lg-6 col-md-12 mb-3">
// 						<div className="panel panel-default">
// 							<div
// 								className="panel-body wt-panel-body dashboard-card-2"
// 								style={{ backgroundColor: "#e0f7fa" }}
// 							>
// 								<div className="wt-card-wrap-2 d-flex align-items-center justify-content-between">
// 									<div className="wt-card-icon-2">
// 										<i className="flaticon-resume" />
// 									</div>
// 									<div className="wt-card-right counter fw-bold fs-4 text-info">
// 										<CountUp end={435} duration={2} />
// 									</div>
// 								</div>
// 								<div className="wt-card-bottom-2 mt-2">
// 									<h4 className="m-b0">Application Sent</h4>
// 								</div>
// 							</div>
// 						</div>
// 					</div>

// 					{/* Card 3 - In Progress */}
// 					<div className="col-xl-6 col-lg-6 col-md-12 mb-3">
// 						<div className="panel panel-default">
// 							<div
// 								className="panel-body wt-panel-body dashboard-card-2"
// 								style={{ backgroundColor: "#fff3e0" }}
// 							>
// 								<div className="wt-card-wrap-2 d-flex align-items-center justify-content-between">
// 									<div className="wt-card-icon-2">
// 										<i className="flaticon-envelope" />
// 									</div>
// 									<div className="wt-card-right counter fw-bold fs-4 text-warning">
// 										<CountUp end={28} duration={2} />
// 									</div>
// 								</div>
// 								<div className="wt-card-bottom-2 mt-2">
// 									<h4 className="m-b0">In Progress</h4>
// 								</div>
// 							</div>
// 						</div>
// 					</div>

// 					{/* Card 4 - Assessments */}
// 					<div className="col-xl-6 col-lg-6 col-md-12 mb-3">
// 						<div className="panel panel-default">
// 							<div
// 								className="panel-body wt-panel-body dashboard-card-2"
// 								style={{ backgroundColor: "#e8f5e9" }}
// 							>
// 								<div className="wt-card-wrap-2 d-flex align-items-center justify-content-between">
// 									<div className="wt-card-icon-2">
// 										<i className="flaticon-bell" />
// 									</div>
// 									<div className="wt-card-right counter fw-bold fs-4 text-success">
// 										<CountUp end={18} duration={2} />
// 									</div>
// 								</div>
// 								<div className="wt-card-bottom-2 mt-2">
// 									<h4 className="m-b0">Assessments</h4>
// 								</div>
// 							</div>
// 						</div>
// 					</div>
// 				</div>
// 			</div>
// 		</>
// 	);
// }

// export default SectionCandidateOverview;


import { useEffect, useState } from 'react';
import CountUp from "react-countup";

function SectionCandidateOverview() {
	const [stats, setStats] = useState({
		applied: 0,
		inProgress: 0,
		shortlisted: 0
	});
	const [candidate, setCandidate] = useState({ name: 'Loading...', credits: 0 });
	const [notifications, setNotifications] = useState([]);

	useEffect(() => {
		fetchDashboardData();
		// Set up interval to refresh data every 30 seconds
		const interval = setInterval(fetchDashboardData, 30000);
		return () => clearInterval(interval);
	}, []);

	const fetchDashboardData = async () => {
		try {
			const token = localStorage.getItem('candidateToken');
			if (!token) return;

			const [statsResponse, notificationResponse] = await Promise.all([
				fetch('http://localhost:5000/api/candidate/dashboard/stats', {
					headers: { 'Authorization': `Bearer ${token}` }
				}),
				fetch('http://localhost:5000/api/notifications/candidate', {
					headers: { 'Authorization': `Bearer ${token}` }
				})
			]);
			
			if (statsResponse.ok) {
				const data = await statsResponse.json();
				setStats(data.stats);
				setCandidate(data.candidate);
			}

			if (notificationResponse.ok) {
				const notificationData = await notificationResponse.json();
				if (notificationData.success) {
					setNotifications(notificationData.notifications || []);
				}
			}
		} catch (error) {
			console.error('Error fetching dashboard data:', error);
		}
	};

	const baseCards = [
		{
			bg: "#e0f7fa",
			icon: "flaticon-resume",
			color: "text-info",
			count: stats.applied,
			label: "Applied",
		},
		{
			bg: "#fff3e0",
			icon: "flaticon-envelope",
			color: "text-warning",
			count: stats.inProgress,
			label: "In Progress",
		},
		{
			bg: "#e8f5e9",
			icon: "flaticon-bell",
			color: "text-success",
			count: stats.shortlisted,
			label: "Shortlisted",
		},
	];

	const creditsCard = {
		bg: "#f0f4ff",
		icon: "flaticon-job",
		color: "text-primary",
		count: candidate.credits || 0,
		label: "Credits Available",
	};

	// Only show credits for placement candidates
	const hasCredits = candidate.registrationMethod === 'placement';
	const cards = hasCredits ? [creditsCard, ...baseCards] : baseCards;

	return (
		<>
			<div className="row" style={{ marginBottom: '2rem' }}>
				{cards.map((card, index) => (
					<div className={`col-xl-${hasCredits ? '3' : '4'} col-lg-${hasCredits ? '3' : '4'} col-md-6 mb-3`} key={index}>
						<div className="panel panel-default">
							<div className="panel-body wt-panel-body dashboard-card-2" style={{ backgroundColor: card.bg }}>
								<div className="d-flex align-items-center" style={{ display: "flex", justifyContent: "flex-end" }}>
									<div className={`wt-card-icon-2 me-3 fs-2 ${card.color}`} style={{ lineHeight: "1" }}>
										<i className={card.icon} />
									</div>
									<div>
										<div className={`counter fw-bold fs-4 ${card.color}`}>
											<CountUp end={card.count} duration={2} />
										</div>
										<h5 className="mb-0 mt-1">{card.label}</h5>
									</div>
								</div>
							</div>
						</div>
					</div>
				))}
			</div>
		</>
	);
}

export default SectionCandidateOverview;
